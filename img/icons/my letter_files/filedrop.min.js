(function(n){n.fn.filedrop=function(t,i){var u=i,s=t.Accept.split(/\s*,\s*/).map(function(n){return n.substring(1).toUpperCase()}),r=[],h=function(n){var t=n.name.lastIndexOf(".");return t!==-1?n.name.substring(t+1).toUpperCase():null},c=function(){var n=1,t;do{t=!1;for(let i=0;i<r.length;i++)if(r[i].id===n){n+=1;t=!0;break}}while(t);return n},f=function(n){n=n||event;n.preventDefault();n.stopPropagation()},l=function(t){for(var i=0;i<r.length;i++)if(r[i].id===t)break;i<r.length&&(r.splice(i,1),n("#filedrop-"+u).find("#fileupload-"+t).remove(),r.length===0&&n("#filedrop-"+u).find(".chooseFilesLabel").removeClass("hidden"))},a=function(t){for(var f,e,o,i=0;i<r.length;i++)if(r[i].id===t)break;i<r.length&&i!==0&&(f=r[i-1].id,e=r[i-1],r[i-1]=r[i],r[i]=e,o=n("#filedrop-"+u+" > #fileupload-"+t).detach(),n("#filedrop-"+u+" > #fileupload-"+f).before(o))},v=function(t){for(var f,e,o,i=0;i<r.length;i++)if(r[i].id===t)break;i<r.length&&i!==r.length-1&&(f=r[i+1].id,e=r[i+1],r[i+1]=r[i],r[i]=e,o=n("#filedrop-"+u+" > #fileupload-"+t).detach(),n("#filedrop-"+u+" > #fileupload-"+f).after(o))},y=function(i){var e=c(),w=i.name,h=null,y=null,p,o,s;if(t.UseSorting){h=n('                    <a class="fileMoveUpLink">                        <i class="fa fa-arrow-up"><\/i>                    <\/a>                ');y=n('                    <a class="fileMoveDownLink">                        <i class="fa fa-arrow-down"><\/i>                    <\/a>                ');h.find("i").on("click",function(){a(e)});y.find("i").on("click",function(){v(e)})}p=n('                <a class="fileRemoveLink">                    <i class="fa fa-times"><\/i>                <\/a>            ');p.find("i").on("click",function(){l(e)});o=n('                <span class="filename">                    <label class="custom-file-upload">'+w+"<\/label>                <\/span>            ");h!==null&&y!==null&&(o.append(h),o.append(y));o.append(p);s=n('<div id="fileupload-'+e+'" class="fileupload"><\/div>');s.on("dragover",f);s.on("drop",f);s.append(o);n("#filedrop-"+u).append(s);r.push({id:e,file:i,name:w})},e=function(n=1,i=undefined){var o,s,f,u,e;if(i===undefined&&(i=t.MaximumUploadFiles),r.length){if(r.length<n||r.length>i)return t.showAlert(t.FileAmountMessage),null;for(o=new FormData,e=0;e<r.length;e++)if(u=r[e],s=u.name.lastIndexOf("."),f=s>=0?u.name.substring(s+1).toUpperCase():null,f!==null&&t.UploadOptions.indexOf(f)!==-1)o.append(u.id,u.file,u.name);else return t.showAlert(t.FileWrongTypeMessage+f),null;return o}return t.showAlert(t.FileSelectMessage),null},o=function(i){var o=!1,c,f,e;if(i.target.files&&i.target.files.length)if(c=i.target.files.length+r.length,c<=t.MaximumUploadFiles)for(t.hideAlert(),e=0;e<i.target.files.length;e++)f=h(i.target.files[e]),f!==null&&s.indexOf(f)!==-1?(n("#filedrop-"+u).find(".chooseFilesLabel").addClass("hidden"),y(i.target.files[e])):(o=!0,f!==null&&(f=f.toUpperCase()),t.showAlert(t.FileWrongTypeMessage+f));else o=!0,t.showAlert(t.FileAmountMessage),window.setTimeout(function(){t.hideAlert()},5e3);return n("input#UploadFileInput-"+u).val(""),!o},p=function(i){if(t.showLoader(),o(i)){var r=e();r!==null&&n.ajax({method:"POST",url:t.APIBasePath+"Common/UploadFile",data:r,processData:!1,contentType:!1,cache:!1,timeout:6e5,success:t.Method,xhr:function(){var i=n.ajaxSettings.xhr();return i.upload&&i.upload.addEventListener("progress",t.progress,!1),i},error:function(n){t.showAlert(n.Status)}})}};if(t.UploadAndRedirect)n("input#UploadFileInput-"+u).on("change",p);else n("input#UploadFileInput-"+u).on("change",o);return{get droppedFiles(){return r},get prepareFormData(){return e},reset:function(){r=[];n("#filedrop-"+u).find("div[id^=fileupload-]").remove();n("#filedrop-"+u).find(".chooseFilesLabel").removeClass("hidden")}}}})(jQuery);